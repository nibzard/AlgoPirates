\usepackage{newunicodechar}
\usepackage{fontspec}

% Set up emoji font support for LuaTeX
\directlua{luaotfload.add_fallback("emojifallback", {"Apple Color Emoji:mode=harf;", "Noto Color Emoji:mode=harf;", "Segoe UI Emoji:mode=harf;"})}

% Set up emoji command with explicit font switching
\newfontfamily\emojifont{Apple Color Emoji}[Renderer=HarfBuzz]
\newcommand{\emoji}[1]{{\emojifont #1}}

% Unicode character mappings - preserve emojis where possible
\newunicodechar{â±}{\emoji{â±}}
\newunicodechar{ğŸ”}{\emoji{ğŸ”}}
\newunicodechar{ğŸ“}{\emoji{ğŸ“}}
\newunicodechar{ğŸš€}{\emoji{ğŸš€}}
\newunicodechar{ğŸ¯}{\emoji{ğŸ¯}}
\newunicodechar{ğŸ }{\emoji{ğŸ }}
\newunicodechar{ğŸ”§}{\emoji{ğŸ”§}}
\newunicodechar{ğŸ˜Š}{\emoji{ğŸ˜Š}}
\newunicodechar{ğŸ’¡}{\emoji{ğŸ’¡}}
\newunicodechar{âš–}{\emoji{âš–}}
\newunicodechar{ğŸ“š}{\emoji{ğŸ“š}}
\newunicodechar{ğŸ†}{\emoji{ğŸ†}}
\newunicodechar{ğŸ“…}{\emoji{ğŸ“…}}
\newunicodechar{ğŸ”¢}{\emoji{ğŸ”¢}}
\newunicodechar{ğŸ•}{\emoji{ğŸ•}}
\newunicodechar{ğŸ”„}{\emoji{ğŸ”„}}
\newunicodechar{ğŸ“}{\emoji{ğŸ“}}
\newunicodechar{ğŸ“Š}{\emoji{ğŸ“Š}}
\newunicodechar{ğŸ’°}{\emoji{ğŸ’°}}
\newunicodechar{ğŸ”¤}{\emoji{ğŸ”¤}}
\newunicodechar{ğŸ§©}{\emoji{ğŸ§©}}
\newunicodechar{ğŸ“}{\emoji{ğŸ“}}
\newunicodechar{ğŸ’»}{\emoji{ğŸ’»}}
\newunicodechar{ğŸ‘¨}{\emoji{ğŸ‘¨}}
\newunicodechar{ğŸ‘©}{\emoji{ğŸ‘©}}
\newunicodechar{ğŸ‘§}{\emoji{ğŸ‘§}}
\newunicodechar{ğŸ‘¦}{\emoji{ğŸ‘¦}}
\newunicodechar{ğŸ“‹}{\emoji{ğŸ“‹}}
\newunicodechar{ğŸ“–}{\emoji{ğŸ“–}}
\newunicodechar{ğŸ…}{\emoji{ğŸ…}}
\newunicodechar{ğŸ“}{\emoji{ğŸ“}}
\newunicodechar{ğŸ´}{\emoji{ğŸ´}}
\newunicodechar{â˜ }{\emoji{â˜ }}
\newunicodechar{â†’}{\ensuremath{\rightarrow}}
\newunicodechar{â†”}{\ensuremath{\leftrightarrow}}
\newunicodechar{âœ“}{\ensuremath{\checkmark}}
\newunicodechar{â–¡}{\ensuremath{\square}}
\newunicodechar{â˜}{\ensuremath{\square}}
\newunicodechar{â–³}{\ensuremath{\triangle}}
\newunicodechar{â—‹}{\ensuremath{\circ}}
\newunicodechar{â˜…}{\ensuremath{\star}}
\newunicodechar{â– }{\ensuremath{\blacksquare}}
\newunicodechar{â‰ˆ}{\ensuremath{\approx}}
\newunicodechar{â‰¥}{\ensuremath{\geq}}
\newunicodechar{â‰¤}{\ensuremath{\leq}}

% Fix math mode for fractions in text
\usepackage{amsmath}
\let\oldtfrac\tfrac
\renewcommand{\tfrac}[2]{\ensuremath{\oldtfrac{#1}{#2}}}